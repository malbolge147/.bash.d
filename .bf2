#!/bin/bash

dmp2() {
	fd --type d --empty --exec rmdir {}
}

pyempty() {
	fd --type f --extension py --size 0B --exclude '__init__.py'
	#    fd --type f --extension py --size 0B --exclude '__init__.py'
}

ex_tar() {
	for f in *; do bash -c "cd $f && tar -xzvf *.tar.gz"; done
}

z77() {
	local name="$(basename "$PWD")"
	local archive="../${name}.7z"

	echo "üóúÔ∏è Compressing '$name' into '$archive'..."
	7z a -mx9 "$archive" "../$name" || {
		echo "‚ùå Compression failed."
		return 1
	}

	#    read -p "Delete original folder '$PWD'? [y/N] " ans
	#    [[ "$ans" =~ ^[Yy]$ ]] || {
	#        echo "Skipped deletion."
	#        return 0
	#    }

	cd .. || {
		echo "‚ùå Failed to change directory."
		return 1
	}

	rm -rf "$name"
	echo "‚úÖ Done: created '$archive' and removed '$name/'"
}

7zippr() {
	7z a -mx9 "../$(basename "$PWD").7z" "../$(basename "$PWD")"
}
stree() {
	tree -h --du | sort -hr
}
atree() {
	tree -d -L 2 | tail -n 1
}
dtree() {
	tree -d -L 2
}

btree() {
	tree -a -L 4 -h /path/to/backup | grep "GB"

}
ftree() {
	tree -a -I "__pycache__|.git" -L 3 -h
}

gtree() {
	tree -a -I "node_modules|.git|dist|build" -L 3 -h
}

la() {
	ls -a
}
lu() {
	ls -hla
}
pss() {
	grep "$@" ~/isaac/pip.txt
}

mkdr() {
	mkdir -p "$@" && cd "$_"
}

lj() {
	ls -la | awk 'NR>1 && !/^d/ {printf "%s %.2f MB\n", $9, $5/1024/1024}'
}

# Function to list files and directories with human-readable sizes

rmaa() {
	read -p "Are you sure you want to delete all files except .git? [y/N]: " yn
	if [[ "$yn" == "y" || "$yn" == "Y" ]]; then
		find . -mindepth 1 -not -name '.git' -not -path './.git/*' -exec rm -rf {} +
		echo "All files except .git deleted."
	else
		echo "Aborted."
	fi
}

# --------- C++ Programming Shortcuts ---------
cpprun() {
	if [ $# -eq 0 ]; then
		echo "Usage: cpprun <file.cpp>"
		return 1
	fi
	file="$1"
	exe="${file%.cpp}"
	g++ -std=c++17 -Wall -Wextra -O2 "$file" -o "$exe" && ./"$exe"
}
cppnew() {
	if [ $# -eq 0 ]; then
		echo "Usage: cppnew <filename.cpp>"
		return 1
	fi
	file="$1"
	cat >"$file" <<'EOF'
#include <bits/stdc++.h>
using namespace std;

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);

    // Your code here

    return 0;
}
EOF
	echo "Created $file with basic C++ template"
	nano "$file"
}

# --------- Python Shortcuts ---------
# Run Python scripts easily

# Create new Python script with basic template
pynew() {
	if [ $# -eq 0 ]; then
		echo "Usage: pynew <script.py>"
		return 1
	fi
	file="$1"
	cat >"$file" <<'EOF'
#!/usr/bin/env python3

import sys

def main():
    # Your code here
    pass

if __name__ == "__main__":
    main()
EOF
	chmod +x "$file"
	echo "Created $file with Python template"
#	nano "$file"
}

g2() {
	# Clone only the default branch (main/master/whatever) as a bare repo.
	# Usage: mygit2 <repo-url> [target-dir]

	if [ -z "$1" ]; then
		echo "Usage: mygit2 <repo-url> [target-dir]"
		return 1
	fi

	local url="$1"
	local target="${2:-}"

	# Get default branch from remote (e.g. main or master)
	local branch
	branch=$(git ls-remote --symref "$url" HEAD 2>/dev/null | awk '/^ref:/ {print $2}' | sed 's|refs/heads/||')

	if [ -z "$branch" ]; then
		echo "‚ùå Could not determine default branch for $url"
		return 1
	fi

	# Derive repo name if no custom folder name given
	local repo
	repo=$(basename "$url" .git)

	# Determine target directory
	if [ -z "$target" ]; then
		target="${repo}.git"
	fi

	echo "üîç Default branch: $branch"
	echo "üì¶ Cloning only '$branch' from $url into $target ..."
	git clone --single-branch --branch "$branch" --bare "$url" "$target" || return 1

	echo "‚úÖ Done!"
	echo "   To update later: cd $target && git fetch origin $branch"
}

trr() {
	local name="$(basename "$PWD")"
	local archive="../${name}.tar"

	echo "üóúÔ∏è Compressing '$name' into '$archive'..."
	tar -cf "$archive" -C .. "$name" || {
		echo "‚ùå Compression failed."
		return 1
	}

	# Optional deletion (currently commented out)
	# read -p "Delete original folder '$PWD'? [y/N] " ans
	# [[ "$ans" =~ ^[Yy]$ ]] || {
	#     echo "Skipped deletion."
	#     return 0
	# }

	cd .. || {
		echo "‚ùå Failed to change directory."
		return 1
	}

	rm -rf "$name"
	echo "‚úÖ Done: created '$archive' and removed '$name/'"
}


txz() {
	local name="$(basename "$PWD")"
	local archive="../${name}.tar.xz"

	echo "üóúÔ∏è Compressing '$name' into '$archive' (xz -e -9)..."
	tar -c --xz -I "xz -e -9" -f "$archive" -C .. "$name" || {
		echo "‚ùå Compression failed."
		return 1
	}

	# Optional deletion (currently commented out)
	# read -p "Delete original folder '$PWD'? [y/N] " ans
	# [[ "$ans" =~ ^[Yy]$ ]] || {
	#     echo "Skipped deletion."
	#     return 0
	# }

	cd .. || {
		echo "‚ùå Failed to change directory."
		return 1
	}

	rm -rf "$name"
	echo "‚úÖ Done: created '$archive' and removed '$name/'"
}
